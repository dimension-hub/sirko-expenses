<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>–í–∏—Ç—Ä–∞—Ç–∏ –∫–ª—É–±—É ¬´–°—ñ—Ä–∫–æ¬ª</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#43766c" />
    <link rel="icon" href="logo.png" />
    <link rel="apple-touch-icon" href="logo.png" />
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('service-worker.js');
        });
      }
    </script>
    <style>
      :root {
        --primary: #43766c;
        --accent: #ffb84c;
        --bg: #fefbf6;
        --text: #222;
        --radius: 14px;
        --shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        --font: 'Inter', 'Segoe UI', system-ui, sans-serif;
      }
      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      html, body {
        margin: 0;
        padding: env(safe-area-inset);
        font-family: var(--font);
        background: var(--bg);
        color: var(--text);
        font-size: 16px;
        line-height: 1.5;
      }
      header {
        text-align: center;
        padding: 1rem;
      }
      header img {
        width: 64px;
        height: 64px;
        border-radius: 12px;
        margin-bottom: 0.5rem;
      }
      h2 {
        text-align: center;
        font-size: 1.6rem;
        color: var(--primary);
        margin: 0.5rem 0;
      }
      form {
        background: #fff;
        margin: 1rem auto;
        padding: 1.5rem;
        border-radius: var(--radius);
        max-width: 560px;
        box-shadow: var(--shadow);
        display: none;
      }
      label {
        display: block;
        margin-top: 1rem;
        font-weight: 600;
      }
      input, select, textarea {
        width: 100%;
        padding: 1rem;
        font-size: 1rem;
        margin-top: 0.4rem;
        border-radius: var(--radius);
        border: 1px solid #ccc;
        background: #f9f9f9;
      }
      input:focus, select:focus, textarea:focus {
        border-color: var(--accent);
        background: #fff;
        outline: none;
      }
      textarea {
        min-height: 100px;
        resize: vertical;
      }
      button {
        margin-top: 1.5rem;
        width: 100%;
        padding: 1rem;
        font-size: 1.1rem;
        font-weight: 600;
        background: linear-gradient(to right, var(--primary), var(--accent));
        color: white;
        border: none;
        border-radius: var(--radius);
        cursor: pointer;
      }
      #unauthorized {
        display: none;
        text-align: center;
        color: red;
        font-weight: bold;
        margin-top: 2rem;
      }
    </style>
  </head>
  <body>
    <header>
      <img src="logo.png" alt="–°—ñ—Ä–∫–æ –ö–ª—É–±" />
      <h2>–í–∏—Ç—Ä–∞—Ç–∏ –∫–ª—É–±—É ¬´–°—ñ—Ä–∫–æ¬ª</h2>
    </header>

    <div id="g_id_onload"
      data-client_id="YOUR_GOOGLE_CLIENT_ID"
      data-callback="handleCredentialResponse"
      data-auto_prompt="false">
    </div>
    <div class="g_id_signin"
      data-type="standard"
      data-size="large"
      data-theme="outline"
      data-text="sign_in_with"
      data-shape="rectangular"
      data-logo_alignment="left">
    </div>

    <form id="expenseForm">
      <label for="info">üìÑ –©–æ –±—É–ª–æ –æ–ø–ª–∞—á–µ–Ω–æ?</label>
      <input type="text" name="info" id="info" required />
      <label for="category">üóÇ –ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
      <select name="category" id="category" required>
        <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>
        <option>üè† –û—Ä–µ–Ω–¥–∞ —Ç–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</option>
        <option>üîß –¢—Ä–µ–Ω–µ—Ä–∏ —Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª</option>
        <option>ü¶¥ –•–∞—Ä—á—É–≤–∞–Ω–Ω—è, –ª–∞—Å–æ—â—ñ, –º–æ—Ç–∏–≤–∞—Ü—ñ—è</option>
        <option>üíº –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏</option>
        <option>üì¢ –†–µ–∫–ª–∞–º–∞ —Ç–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥</option>
        <option>üßπ –ß–∏—Å—Ç–æ—Ç–∞ —Ç–∞ –≥—ñ–≥—ñ—î–Ω–∞</option>
        <option>üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏</option>
        <option>üéì –û—Å–≤—ñ—Ç–∞ —ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è</option>
        <option>üì¶ –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è —Ç–∞ —Ä–µ–º–æ–Ω—Ç</option>
        <option>üê∂ –í–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ —Å–æ–±–∞–∫ –∫–ª—É–±—É</option>
        <option>üì± –û–Ω–ª–∞–π–Ω –ø–æ–∫—É–ø–∫–∏ —ñ –ø—ñ–¥–ø–∏—Å–∫–∏</option>
        <option>üìä –ù–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏</option>
      </select>
      <label for="payer">üë§ –ö–∏–º –æ–ø–ª–∞—á–µ–Ω–æ</label>
      <input type="email" name="payer" id="payer" required />
      <label for="amount">üí∞ –°—É–º–∞</label>
      <input type="number" name="amount" id="amount" step="0.01" min="0" required />
      <label for="date">üìÜ –î–∞—Ç–∞</label>
      <input type="date" name="date" id="date" required />
      <label for="notes">üìù –ö–æ–º–µ–Ω—Ç–∞—Ä</label>
      <textarea name="notes" id="notes"></textarea>
      <button type="submit">‚úÖ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤–∏—Ç—Ä–∞—Ç—É</button>
    </form>

    <div id="unauthorized">
      ‚õî –î–æ—Å—Ç—É–ø –¥–æ–∑–≤–æ–ª–µ–Ω–æ –ª–∏—à–µ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ @sirko.club
    </div>

    <script>
      function handleCredentialResponse(response) {
        const idToken = response.credential;
        const base64Url = idToken.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        const payload = JSON.parse(jsonPayload);
        const email = payload.email;

        if (email.endsWith('@sirko.club')) {
          document.getElementById('expenseForm').style.display = 'block';
          document.querySelector('.g_id_signin').style.display = 'none';
        } else {
          document.getElementById('unauthorized').style.display = 'block';
        }
      }

      document.getElementById('expenseForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const form = e.target;
        const data = {
          info: form.info.value.trim(),
          category: form.category.value,
          payer: form.payer.value.trim(),
          amount: form.amount.value,
          date: form.date.value,
          notes: form.notes.value.trim(),
        };
        google.script.run.withSuccessHandler(() => {
          alert("‚úÖ –î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω—ñ!");
          form.reset();
        }).submitExpense(data);
      });
    </script>
  </body>
</html>
